# [12.2. 仮想環境の作成](https://docs.python.jp/3/tutorial/venv.html#creating-virtual-environments)

< [12. 仮想環境とパッケージ](https://docs.python.jp/3/tutorial/venv.html#virtual-environments-and-packages) < [Python チュートリアル](https://docs.python.jp/3/tutorial/index.html) < [ドキュメント](https://docs.python.jp/3/index.html)

Pythonの環境構築には苦労した。じつは今回の学習環境を構築するにあたり既にvenvを使用した。以下参照。

https://github.com/pylangstudy/201705/blob/master/27/Python%E5%AD%A6%E7%BF%92%E7%92%B0%E5%A2%83%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B.md

## [venv](https://docs.python.jp/3/library/venv.html#module-venv)

> 仮想環境の作成と管理を行うためのモジュールが venv です。 venv は通常利用可能なもっとも新しいバージョンの Python をインストールします。複数のバージョンの Python がインストールされている場合、 python3 のように利用したいバージョンを指定して実行することで Python バージョンを選択できます。

意味不明。仮想環境をつくるツールなのに、Pythonをインストールするとあるのだが？Pythonをインストールするのではなく、Pythonにパッケージ(ライブラリ)をインストールするの間違いでは？

たしかvenvはわりと新しい機能だったはず。それまではいくつかのサードパーティ製ライブラリが候補だったはず。そのへんの話も非常に複雑だった気がする。"Python 仮想環境"のようにググれば、情報が錯綜していることがわかる。とても把握できないし、まとめる自信もない。それほどに混沌としている。おそらくPythonのバージョンごとに遷移してきたと思われる。

### 環境構築

私個人が知ったことを勝手に補足する。

#### pyenv

* Python本体の仮想環境(例:pyenv)
* Pythonパッケージ(ライブラリ)の仮想環境(例:venv)

Python文書は仮想環境のまえに、Python本体の入手について説明がなかったので補足する。pyenvはPython本体のソースコードをダウンロード、コンパイルするサードパーティ製ツール。複数のPythonバージョンを共存させられる。使用するPythonのバージョン指定ができる。

Pythonのソースコードを手動で入手し、手動でコンパイルする人にとっては不要のツールかもしれない。しかしPythonはバージョンによって大きく変わる。ライブラリの都合上からも複数のバージョンを併用せねばならないことも生じうる。

どのみちコンパイルに必要なライブラリは別途入手せねばならない。OSごとに異なるがLinuxなら別途`apt-get`のようなコマンドを打つことになる。初心者には難解であることに変わりない。Windowsインストーラのように「次へ」ボタンをクリックしているだけで完了してくれはしない。

#### パッケージの仮想環境ツール

* http://qiita.com/maskedw/items/aaa2fd7abfd493cf2820
    * http://ymotongpoo.hatenablog.com/entry/2017/01/29/002039

ほかにも調べると色々あるようで、もう何がなんだかさっぱりわからない。歴史的な背景があるらしく、それらを追わないと理解できなさそう。おそらくPythonのバージョンごとに利用するツールが違うのだと思う。

[前回](https://github.com/pylangstudy/201707/tree/master/01/01)によると仮想環境が必要な理由も、バージョンごとによる差異が原因だった。まさか仮想環境ツール自身も、バージョン差異により動作したりしなかったりなどで使い分ける必要があるとは。どうりで混乱するわけである。終わりなきメタ問題。

できれば仮想環境など作らずともPythonライブラリを利用したいものである。しかし、[前回](https://github.com/pylangstudy/201707/tree/master/01/01)によるとアプリごとに依存ライブラリの利用バージョンが異なることで動作しなくなることが起こりうるという。Pythonを利用するかぎり無関係ではいられない。いつ仮想環境が必要になるのか、その理由はなぜか。どうすれば判別できるのか。それらの判断、知識、技術が必要になりうる時点で敷居が高い。exeダブルクリックだけで利用したい。

## venvの使い方

### 仮想環境の作成

仮想環境を作るには、仮想環境を置くディレクトリを決めて、 そのディレクトリのパスを指定して、 venv をスクリプトとして実行します:

```sh
$ python3 -m venv tutorial-env
```

* `tutorial-env`というディレクトリがカレントディレクトリに作成される
* 必要なファイル群が自動作成される
* `tutorial-env`という名前は任意の他の名前でOK

#### 仮想環境の有効化

```sh
$ source tutorial-env/bin/activate
(tutorial-env) $ python
```

* 有効化されると仮想環境の名前が表示される

仮想環境が有効な状態で`pip`によるパッケージをインストールする。バージョン差異による問題はこの仮想環境を複数使い分けることで回避する。

pipについては次の章で。

